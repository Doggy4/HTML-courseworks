<!DOCTYPE html>
<html>
<title>Web Page</title>

<head>
    <script type="text/javascript">
        function randomInteger(min, max) {
            let rand = min - 0.5 + Math.random() * (max - min + 1);

            return Math.round(rand);
        }

        function isDigit(symbol) {
            return symbol >= '0' && symbol <= '9'
        }

        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }


        onload = function () {
            let table = document.body.getElementsByTagName('table')[0]
            let chosen_cell

            table.onclick = function (event) {
                chosen_cell = event.target
                if (chosen_cell.tagName != 'TD') return
                let previous_cell = document.body.getElementsByClassName('cell-highlighted')[0]
                if (previous_cell != undefined)
                    previous_cell.setAttribute('class', '')
                chosen_cell.setAttribute('class', 'cell-highlighted')
            }

            document.onkeypress = function (event) {
                if (isDigit(event.key))
                    chosen_cell.innerText = event.key
            }
        }

        function game() {
            numbers = []

            let row_numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9]
            shuffle(row_numbers)

            for (let i = 0; i < 3; i++) {
                row_numbers = [row_numbers[7], row_numbers[8], row_numbers[0], row_numbers[1], row_numbers[2], row_numbers[3], row_numbers[4], row_numbers[5], row_numbers[6]]
                numbers.push(row_numbers)
                numbers.push([row_numbers[3], row_numbers[4], row_numbers[5], row_numbers[6], row_numbers[7], row_numbers[8], row_numbers[0], row_numbers[1], row_numbers[2]])
                numbers.push([row_numbers[6], row_numbers[7], row_numbers[8], row_numbers[0], row_numbers[1], row_numbers[2], row_numbers[3], row_numbers[4], row_numbers[5]])
            }

            let trs = document.getElementsByTagName('tr')
            let new_numbers = []

            for (let i = 1; i <= numbers.length; i++)
                if (i % 3 == 0)
                    for (shuffled_array of shuffle(numbers.slice(i-3, i)))
                        new_numbers.push(shuffled_array)

            for (let i = 0; i < trs.length; i++) {
                let tds = trs[i].getElementsByTagName('td')
                for (let j = 0; j < tds.length; j++)
                    tds[j].innerText = new_numbers[i][j]
            } 

        }
    </script>

    <style>
        table {
            margin: 2em auto;
            border-spacing: 0;
        }

        td {
            height: 30px;
            width: 30px;
            border: 1px solid;
            text-align: center;
        }

        td:first-child() {
            border-left: 3px solid;
        }

        td:nth-child(3n) {
            border-right: 3px solid;
        }

        tr:first-child() {
            border-top: 3px solid;
        }

        tr:nth-child(3n) td {
            border-bottom: 3px solid;
        }

        .cell-highlighted {
            background-color: #add8e6;
        }
    </style>
</head>

<body>
<button onclick="game()"></button>

    <table>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>
</body>

</html>